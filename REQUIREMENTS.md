# MMA Wiki 刷新プロジェクト - 要件定義書

**作成日**: 2026年2月28日  
**バージョン**: 1.0  
**プロジェクト**: MMA NextGen Wiki Project

---

## 📋 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [機能要件 (Functional Requirements)](#機能要件-functional-requirements)
3. [非機能要件 (Non-Functional Requirements)](#非機能要件-non-functional-requirements)
4. [開発フェーズの定義](#開発フェーズの定義)
5. [実装スコープ](#実装スコープ)

---

## プロジェクト概要

### 目的
電気通信大学MMA部の部内Wiki刷新プロジェクト。現在稼働している旧Wikiのレガシーシステムを、モダンなWeb技術で再構築する。

本プロジェクトは **2つのフェーズ** に分かれています：

1. **フェーズ1: 新歓デモ版（～2026年3月末）**
   - 新歓期に配布する部誌「百萬石」の記事素材として機能するUIモック
   - フロントエンドのデザイン・UX確認が中心
   - バックエンドなしで、ローカルの `useState` でデモンストレーション

2. **フェーズ2: 本番版（2026年4月以降）**
   - 新入生を交えたチーム開発による実装
   - Supabase連携による機能の本格化
   - データベース、認証、リアルタイム同時編集対応

### 利用想定ユーザー
- 部員（記事の執筆・編集）
- 部内メンバー（記事の閲覧・検索）
- 新入生（部の情報取得・学習リソースの活用）

---

## 機能要件 (Functional Requirements)

### FR-1: Markdownエディタ機能

#### 概要
テキストベースの記事執筆を直感的に行えるエディタを提供する。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **リアルタイムプレビュー** | 入力と同時に右パネルにHTML/Markdownプレビューを表示 | 🔴 高 | P1 (デモ版) |
| **テキスト装飾ツール** | B(太字), I(斜体), U(下線), H1-H3(見出し), リスト, リンク, コード等のボタン | 🔴 高 | P1 (デモ版) |
| **画像/PDF添付** | ドラッグ&ドロップで画像やPDFを埋め込み、Markdown記法に自動変換 | 🟡 中 | P2 (本番版) |
| **Markdown記法対応** | 一般的なMarkdown（GFM形式）に完全対応 | 🔴 高 | P1 (部分) / P2 (完全) |
| **構文ハイライト** | スニペット・コードブロックの表示を見やすく | 🟡 中 | P2 (本番版) |
| **自動保存（下書き）** | 編集内容を定期的に自動保存（未発行状態は下書きとして） | 🟡 中 | P2 (本番版) |

---

### FR-2: 認証・アカウント機能

#### 概要
ユーザーの識別と権限制御を行う。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **ログイン/ログアウト** | メールアドレス・パスワードまたはOAuth（Google, GitHub）による認証 | 🔴 高 | P1 (デモ版) / P2 (OAuth拡張) |
| **権限ロール定義** | 3段階ロール（ゲスト/一般/スーパーユーザー）の実装 | 🔴 高 | P1 (基本) / P2 (RLS完全実装) |
| **ゲストアカウント** | ログインなしで記事の閲覧が可能 | 🟡 中 | P1 (基本) / P2 (RLS対応) |
| **一般ユーザー（部員）** | 記事の新規作成・編集・削除、権限設定 | 🔴 高 | P1 (基本) / P2 (拡張) |
| **スーパーユーザー（管理者）** | すべてのページへのアクセス・編集権限、規約違反時の削除・修復 | 🔴 高 | P2 (本番版) |

---

### FR-3: 記事の投稿・管理機能

#### 概要
記事（ページ）のライフサイクル全体を管理する。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **新規作成** | 空白ページから新しい記事を作成開始 | 🔴 高 | P1 (デモ版) |
| **編集** | 既存記事の内容を修正・変更 | 🔴 高 | P1 (デモ版) |
| **削除** | 不要な記事を削除（スーパーユーザーのみ） | 🟡 中 | P2 (本番版) |
| **公開/下書き切り替え** | 記事を公開状態または下書き状態で管理 | 🔴 高 | P2 (本番版) |
| **GUIでの権限設定** | コマンドラインなしにブラウザから 読み取り/編集 権限をGUIで設定 | 🔴 高 | P2 (本番版) |
| **タグ付け** | 記事にカテゴリー/タグを付与 | 🟡 中 | P2 (本番版) |
| **メタデータ管理** | 作成者, 作成日時, 最終編集者, 最終編集日時を自動記録 | 🔴 高 | P2 (本番版) |

---

### FR-4: 記事一覧（フィード）機能

#### 概要
記事を一覧で表示し、ユーザーが効率よく探索・アクセスできる。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **ブログ形式表示** | 記事を時系列（新着順）で表示 | 🔴 高 | P1 (ブログページ) / P2 (高度な表示) |
| **全記事の一覧表示** | 権限に応じたすべての記事をブラウズ表示 | 🔴 高 | P1 (基本) / P2 (検索連携) |
| **カード表示** | 記事のプレビュー（タイトル、説明、アイキャッチ）をカード形式で表示 | 🟡 中 | P1 (基本) / P2 (拡張) |
| **ページネーション** | 大量の記事に対応した前後ページ表示 | 🟡 中 | P1 (基本) / P2 (本格化) |
| **タグフィルター** | タグをクリックして記事を絞り込み表示 | 🟡 中 | P2 (本番版) |
| **カテゴリ分け** | プロジェクト/イベント/資料等の分類表示 | 🟡 中 | P1 (プレースホルダー) / P2 (本格化) |

---

### FR-5: 検索機能

#### 概要
記事タイトルと内容からキーワード検索を可能にする。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **キーワード検索** | タイトル・内容・タグを対象とした全文検索 | 🔴 高 | P2 (本番版) |
| **検索結果表示** | マッチした記事を一覧で表示（関連度順） | 🔴 高 | P2 (本番版) |
| **検索履歴** | よく検索されるキーワードをUI上に表示（オプション） | 🟢 低 | P2 (以降) |

---

### FR-6: 変更履歴（バージョン管理）とロールバック機能

#### 概要
記事の過去版を管理し、必要に応じて復元可能にする。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **変更履歴表示** | 記事の編集履歴（誰が何時に編集を行ったか）を時系列で表示 | 🟡 中 | P2 (本番版) |
| **バージョン比較** | 過去版と現在版をdiff表示 | 🟡 中 | P2 (本番版) |
| **ロールバック** | 過去のバージョンに記事を復元（スーパーユーザーのみ） | 🟡 中 | P2 (本番版) |

---

### FR-7: 見出しからの目次（TOC）自動生成機能

#### 概要
長い記事に対して、キリ番見出しから自動的に目次を生成し、内部リンク機能を提供する。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **自動目次生成** | H1-H3見出しを抽出して目次を生成 | 🟡 中 | P2 (本番版) |
| **クリッキング可能** | 目次項目をクリックすると該当見出しにスクロール | 🟡 中 | P2 (本番版) |

---

### FR-8: 同時編集時のロック（排他制御）表示

#### 概要
複数ユーザーが同じ記事を編集する際の競合を防ぎ、ユーザーに明示する。

#### 詳細要件

| 項目 | 説明 | 優先度 | 実装フェーズ |
|------|------|--------|-----------|
| **編集中インジケーター** | 誰が記事を編集中かをUI上に表示 | 🟡 中 | P2 (本番版) |
| **入力ロック** | 他ユーザーが編集中の場合、編集を禁止またはマージ機能を提供 | 🟡 中 | P2 (本番版以降) |

---

## 非機能要件 (Non-Functional Requirements)

### NFR-1: ユーザビリティ

#### 概要
エンドユーザーが直感的に操作できるUI/UXを実現する。

| 項目 | 説明 | 実現方法 |
|------|------|--------|
| **直感的操作** | Notion/Zennに近いUIパターンを採用 | 既存UIモックを継続・改善 |
| **モバイル対応** | スマートフォン・タブレットでの快適な使用 | Tailwind CSSのレスポンシブクラス |
| **レスポンシブデザイン** | 様々な画面サイズに対応 | `sm:`, `md:`, `lg:` Breakpoints |
| **キーボード操作** | キーボードショートカット (Ctrl+S で保存等) | JavaScript イベントリスナー |

---

### NFR-2: パフォーマンス

#### 概要
快速で軽量な操作感を実現する。

| 項目 | 説明 | 目標値 |
|------|------|------|
| **初期読み込み時間** | ページの最初の表示まで | < 3 秒 |
| **画面遷移時間** | SPA的な高速遷移 | < 500ms |
| **エディタ入力の遅延** | キータイプの反応性 | < 100ms (リアルタイムプレビュー) |
| **バンドルサイズ** | JavaScript初期ダウンロード | < 500KB (gzip) |

**実現方法**:
- Next.js (Turbopack) による自動最適化
- 大規模エディタは遅延読み込み (lazy loading)
- Supabase キャッシング戦略

---

### NFR-3: セキュリティ

#### 概要
ユーザーデータと権限を強固に保護する。

| 項目 | 説明 | 実現方法 |
|------|------|--------|
| **認証** | Supabase Auth による安全なログイン | OAuth, JWT token |
| **Row Level Security (RLS)** | データベースレベルの権限管理 | PostgreSQL RLS ポリシー |
| **XSS対策** | ユーザー入力のサニタイズ | React automatic escaping, DOMPurify |
| **CSRF対策** | クロスサイトリクエストフォージェリ防止 | Supabase session management |
| **HTTPS強制** | 通信の暗号化 | 本番環境で常時HTTPS |
| **データ暗号化** | 機密情報の暗号化保存（オプション） | Supabase 暗号化機能 |

---

### NFR-4: 保守性

#### 概要
チーム開発を見据えた、将来の改築を容易にする。

| 項目 | 説明 | 実現方法 |
|------|------|--------|
| **コンポーネント分割** | 機能ごとに小分割されたコンポーネント | `components/`ディレクトリに整理 |
| **型安全性** | TypeScript による静的型チェック | tsconfig.json + ESLint |
| **ドキュメント整備** | コードの役割・変更手順を明記 | README.md, WIKI_ARCHITECTURE.md, QUICK_REFERENCE.md 等 |
| **テスト可能性** | ユニットテスト・統合テストが容易な設計 | Jest, React Testing Library |
| **スタイルガイド** | コード規約の統一 | ESLint + Prettier |

---

### NFR-5: OGP対応

#### 概要
Discord や Twitter等でリンク共有時に、タイトル・説明・アイキャッチが表示される。

| 項目 | 説明 | 実現方法 |
|------|------|--------|
| **OGP メタタグ** | `og:title`, `og:description`, `og:image` を動的生成 | Next.js Head + metadata API |
| **動的生成** | 記事のメタデータを自動的にOGPに変換 | Supabase データ取得 → OGP生成 |

---

### NFR-6: アクセシビリティ

#### 概要
障害者・高齢者を含む様々なユーザーが使用可能にする。

| 項目 | 説明 | 実現方法 |
|------|------|--------|
| **WCAG 2.1 AA準拠** | Web Content Accessibility Guidelines への準拠 | semantic HTML, ARIA roles |
| **キーボード操作** | マウスなしでの完全操作が可能 | tabindex, focus management |
| **スクリーンリーダー対応** | 音声読み上げが可能 | alt属性, aria-label, aria-describedby |
| **色のコントラスト** | テキスト・背景の色の明度差を確保 | WCAG AA 4.5:1 以上の比 |
| **フォント可読性** | 読みやすいフォント選択・サイズ | sans-serif, 最小 16px |

---

## 開発フェーズの定義

### 📅 フェーズ1: デモ＆基本機能版（2026年2月～3月末）

#### 目的
新歓期に部誌「百萬石」で配布するビジュアルデモンストレーションと、Supabase連携によるブログ形式での記事表示・管理の実装。新入生が実際に記事を読み、ユーザー権限に応じたアクセス制御を体験できるシステムの構築。

#### スコープ（実装対象）
✅ **実装する**:
- **UI/UX**: Notion風のエディタ・プレビュー、レスポンシブデザイン
- **Supabase連携**:
  - Supabase Authentication（メール+パスワード基本認証）
  - PostgreSQL データベース（ページ/記事管理テーブル）
  - 基本的なRow Level Security (RLS)ポリシー
- **ユーザー権限機能**:
  - 3段階ロール定義（ゲスト/一般/スーパーユーザー）
  - 権限に応じた読み取り/編集アクセス制御
- **ブログ形式表示**:
  - 記事一覧をブログスタイル（時系列・カード）で表示
  - 権限に応じたすべての公開記事の閲覧
  - ページネーション（基本）
- **エディタ・プレビュー機能**
- **複数ページナビゲーション**

❌ **実装しない**:
- OAuth（Google/GitHub）認証 → P2で実装
- 複雑な権限管理GUI → P2で本格化
- 検索機能 → P2で実装
- 変更履歴・ロールバック → P2で実装
- リアルタイム同時編集
- 多言語対応

#### デリバラブル
- Supabase連携、ユーザー権限、ブログ表示機能を備えた Next.jsアプリケーション
- Supabaseプロジェクト初期設定（テーブル設計・RLS基本設定）
- ユーザー権限体系の仕様書
- 部誌掲載用のスクリーンショット・動画
- セットアップガイド（新入生向け）
- [WIKI_ARCHITECTURE.md](./WIKI_ARCHITECTURE.md), [QUICK_REFERENCE.md](./QUICK_REFERENCE.md), [DOCUMENTATION_INDEX.md](./DOCUMENTATION_INDEX.md)

---

### 📅 フェーズ2: 本番版・高度な機能実装（2026年4月～9月）

#### 目的
新入生を交えた**複数チームでの並行開発** により、フェーズ1の基盤の上にさらに高度な機能を実装。Wikiシステムを実用的で安定した本格的なシステムへ発展させる。

#### スコープ（実装対象）
✅ **実装する**（フェーズ1の上に追加）:
- **認証拡張**: OAuth (Google, GitHub) サポート
- **権限管理強化**: 詳細RLSポリシー、権限GUIエディタ
- **FR-4 拡張**: タグフィルター、カテゴリ分け、高度な表示
- **FR-5**: 検索機能（PostgreSQL FTS基盤）
- **FR-6**: 変更履歴・バージョン管理・ロールバック
- **FR-7**: 目次自動生成
- **FR-8**: 同時編集ロック表示
- **メディア管理**: 画像/PDF添付、Supabase Storage連携
- **テスト**: ユニット・統合テスト（Jest, React Testing Library）
- **SEO最適化**: OGP対応、メタタグ自動生成
- **パフォーマンス最適化**: キャッシング戦略、画像最適化
- **ドキュメント充実**: チーム開発マニュアル、デプロイメントガイド

❌ **実装しない（スコープ外）**:
- AI自動要約機能（今後の拡張）
- リアルタイム同時編集CRDT実装（並行編集はロック方式で対応）
- 多言語対応（日本語限定）
- モバイルアプリ（Web版のみ）

#### 複数チーム並行開発体制
**推奨チーム構成**:
- **フロントエンドチーム**: UI/UX改善、コンポーネント拡張
- **バックエンド/インフラチーム**: Supabase設定、API設計、デプロイ
- **QAテストチーム**: テスト自動化、バグ報告
- **ドキュメントチーム**: マニュアル作成、ユーザーガイド

**協業方式**:
- GitHub Flow（main + feature ブランチの軽量運用）またはGit Flow
- 週次スプリント（1スプリント = 1週間）
- 日次スタンドアップMTG（進捗共有）
- PR ベースのコードレビュー

#### デリバラブル
- 本番環境で動作する完全なWikiシステム
- Supabaseプロジェクト完全設定書（RLS, API, テーブル仕様）
- チーム向けの開発マニュアル（ローカルセットアップ含む）
- デプロイメントガイド（Vercel等での本番化）
- ユーザーマニュアル（部員向け）

---

## 実装スコープ

### 機能要件の優先度マトリクス

```
優先度      新歓デモ版          本番版（4月以降）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔴 高      ✅ 必須実装       ✅ 必須実装
           （基本UI）        （フル機能）

🟡 中      ❌ 見送り          ✅ 実装予定
           （時間的 制約）    （チーム開発）

🟢 低      ❌ 見送り          ❌ オプション
           （スコープ外）    （後日検討）
```

### 技術スタック

**共通（P1, P2 両フェーズ）**
- Next.js 16.x (React 19)
- TypeScript
- Tailwind CSS 4
- lucide-react（アイコン）
- ESLint / Prettier

**P1（基本版）**
- Supabase (認証・DB基本構築)
- react-markdown (Markdownエディタ)
- date-fns (日付処理)

**P2のみ追加（本番版）**
- BlockNote (高度なMarkdownエディタ)
- axios / fetch (API高度な呼び出し)
- Jest / React Testing Library (テスト)
- 追加ライブラリ（検索、画像最適化など）

---

## 変更履歴

| 日付 | ドキュメント | 説明 |
|------|------------|------|
| 2026-02-28 | REQUIREMENTS.md v1.1 | フェーズ1にSupabase・権限機能を追加、フェーズ2に複数チーム並行開発を明記 |

---

## 承認

**プロジェクトリード**: MMA Wiki デモプロジェクト  
**最終更新**: 2026年2月28日

---

このドキュメントは、チーム開発へ向けたスコープ管理と優先度付けの基準として機能します。
変更・追加があった場合は、適宜このドキュメントを更新してください。
